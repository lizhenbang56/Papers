---
Url: https://link.springer.com/content/pdf/10.1007/s11633-023-1459-z.pdf
Publish: MachineIntelligenceResearch2024
Year: "2024"
Month: "01"
---
- [[Deep Industrial Image Anomaly Detection A Survey.pdf]]

## 摘要

近年来深度学习的快速发展为工业图像异常检测（IAD）奠定了重要的里程碑。在本文中，我们从神经网络架构、监督级别、损失函数、指标和数据集的角度全面审视了基于深度学习的图像异常检测技术。此外，我们从工业制造中提取了有前景的设置，并回顾了在我们提出的设置下的当前IAD方法。此外，我们突出了图像异常检测的几个开放性挑战。讨论了在不同监督下代表性网络架构的优缺点。最后，我们总结了研究发现并指出未来的研究方向。更多资源可在[https://github.com/M-3LAB/awesome-industrial-anomaly-detection获得。](https://github.com/M-3LAB/awesome-industrial-anomaly-detection%E8%8E%B7%E5%BE%97%E3%80%82)

## 1 Introduction

我们回顾了自深度学习快速发展以来基于深度学习的图像异常检测的最新进展，因为深度学习的快速发展可以将图像异常检测的能力带入工厂生产线。在现代制造业中，图像异常检测（IAD）通常在制造过程结束时进行，试图识别产品缺陷。产品的价格受缺陷严重程度的影响很大。此外，如果缺陷达到一定的阈值，产品将被丢弃。历史上，大多数异常检测任务由人类执行，存在以下许多缺点： 

1）无法避免人类疲劳，导致假阳性现象（即，真实情况是异常的，而人类的判断是正常的）。 
2）长时间而密集的异常检测工作可能会导致健康问题，如视力受损。 
3）定位异常需要大量员工，增加运营成本。 

因此，IAD算法的目标是减少人力劳动，提高生产力和产品质量。在深度学习之前，IAD的性能无法满足工业制造的要求。如今，深度学习方法取得了良好的结果，大多数方法的准确率超过了97%。然而，当涉及到实际应用时，IAD仍然存在许多问题。为了全面探索当前方法的有效性和适用场景，我们在这项调查中对IAD进行了更加仔细的分析，这是必要且重要的。 表1清楚地展示了我们的调查在数据集、指标、神经网络架构、监督级别和工业制造中有前景的设置等方面的优点。作为一个更加专注于传统方法的代表性综述，Czimmermann等人[1] 对深度学习方法的讨论较少，而我们的调查则更加深入地讨论了深度学习。首先，我们的研究使用了两倍于Tao等人[2] 的IAD数据集。其次，我们分析了使用最全面的图像级别和像素级别指标的IAD性能。然而，Cui等人[3] 和Tao等人[2] 仅使用图像级别指标，忽略了IAD的异常定位性能。第三，我们的研究基于不同程度监督的神经网络架构设计开发了一个分类系统。最后，为了弥合学术研究和实际工业需求之间的差距，我们回顾了当前在工业制造环境下的IAD算法。 作为一个新兴领域，对IAD的研究必须充分考虑工业制造的要求。

IAD数据集应该从实际的制造线收集，而不是实验室。由于隐私问题，公众无法访问真实世界的异常数据集。大多数开源的IAD数据集是从无异常的产品中生成异常。换句话说，开源IAD数据集中的异常可能不会出现在实际的生产线上，这使得在工业制造中部署IAD非常具有挑战性。
在缺乏多个领域IAD数据集的情况下，创建统一的IAD模型是具有挑战性的。最近，You等人提出了一个针对多类对象的统一IAD模型。然而，他们忽视了同一工厂生产的商品应该是相同类型的这一观念。例如，汽车制造商生产多种类型的工件，但不生产水果。当前流行的IAD数据集，如MVTec AD和MVTec LOCO，包含许多类别，但没有多个领域。为了模拟真实的制造过程，我们必须创建一个从多个领域收集的新的IAD数据集。
对于IAD性能的图像级和像素级，建立统一的评估方法是迫切需要的。大多数IAD指标将异常掩码（真实情况）缩小到特征图的大小进行评估，这不可避免地降低了评估的精度。此外，我们发现某些IAD方法在图像AUROC上表现良好，但在像素AP上表现不佳，反之亦然。因此，必须开发一种统一的指标，以评估图像和像素级别的IAD性能。

我们应设计一种更有效的损失函数，既可以利用标记数据的指导，又可以探索未标记数据。在现实制造场景中，可用的异常样本数量有限。然而，大多数无监督的IAD方法优于半监督的IAD方法。通过观察半监督IAD的失败，我们呼吁更多关注特征提取和损失函数，这两者可以高效地利用标签的指导和未标记数据的探索。针对上述关键问题，改进从异常样本中提取特征，并重新设计偏差损失函数，可以充分利用标记的异常，并使异常样本的特征空间与正常样本的特征空间分离开来。

该论文将各种方法分类为几个范例，并清楚分析了各种范例的优缺点。这使读者能够快速了解最新技术，并为选择适用于实际应用的算法提供可靠指南。更重要的是，我们分析了不同范例的缺点和当前的主要挑战。随后的研究人员可以快速找到推动该领域发展的方向。

## 1.1 贡献


本调查的主要贡献可以总结如下：

- 我们通过考虑具有不同监督程度的神经网络架构的设计，提供了对图像异常检测的深入审视。
- 它全面审查了不同设置下的当前IAD算法，以弥合学术研究和实际工业制造之间的差距。
- 它总结了IAD的主要问题和潜在挑战，为未来的研究方向提供了概述。
- 本文的其余部分按照图1的结构组织。在第2和第3节中，我们根据不同监督级别的神经网络架构回顾了IAD。接下来，在第4节中，我们回顾了在我们提出的工业制造环境下的最新IAD进展。我们在第5节描述了流行的数据集，并在第5节回顾了度量函数。然后，在第6节中，我们对当前IAD方法在各种数据集上的性能进行分析。最后，在第7节中，我们为IAD提供未来的研究方向。

## 无监督异常检测

目前大多数研究集中在无监督异常检测上，基于这样一个假设：收集异常样本会产生巨大的人力和财力成本。这表明在训练集中仅包含正常样本，而在测试集中包含异常和正常样本。工业图像中的异常检测是ODD（分布外）问题的一个子集。在深度学习兴起之前，差分检测和滤波经常被用于检测工业图像中的异常。随着MVTec AD的发布，工业图像中的异常检测方法可以分为两类：基于特征嵌入和基于重构。目前，更多的异常检测技术基于特征嵌入。

### 2.1 基于特征嵌入的方法

#### 2.1.1 师生网络结构

这些方法的性能非常出色，但它们依赖于预训练模型，如ResNet、VGG和EfficientNet。选择理想的师模型至关重要。这种教学策略总结在表2中。各种技术之间的主要区别在于网络结构和蒸馏方法。

图2中描绘的师生网络结构是检测工业图像异常的最常见技术。这种方法通常选择一个在大规模数据集上预训练的骨干网络的部分层作为固定参数的师模型。在训练期间，师模型向学生模型传授提取正常样本特征的知识。在推理期间，由师网络和学生网络从测试集中提取的正常图像的特征是可比较的，而从测试集中提取的异常图像的特征是相当不同的。通过比较两个网络生成的特征图，可以生成相同大小的异常分数图。然后，通过将异常分数图放大到与输入图像相同的比例，可以获得各种输入图像位置的异常分数。根据该模型的理由，可以确定测试图像是否异常。

Bergmann等人是第一个使用师生网络结构进行异常检测的。该模型简单而有效，明显优于其他基准方法。尽管STPM和MKD都使用了不同网络层下的多尺度特征进行蒸馏，但它们的方式不同。在这种情况下，学生网络提取的正常样本特征更类似于师网络提取的特征，而异常样本的特征则更不相似。

此外，MKD发现，轻量级的学生网络结构比与师网络相同的学生网络结构表现更好。

基于STPM，RSTPM增加了一对师生网络。

当呈现异常图像时，学生网络通常重建正常特征，这些特征可以与师网络的特征区分开来。RSTPM还包括一个机制，用于在师网络和学生网络之间传输特征，以促进特征重建。RD4AD和RSTPM在学习方面存在一定的相似性。RSTPM利用两对师生网络进行特征重建，而RD4AD只使用一对师生网络。RD4AD提出了一个多尺度特征融合（MFF）块和一个单类瓶颈（OCB）来形成嵌入，用于在多个尺度上消除冗余特征，以便单一对师生网络可以有效地执行特征重建。RD4AD的师生网络在推理过程中提取的异常图像特征差异显著。AST得出结论，具有相同结构的师生模型提取的异常图像特征显著相似，因此他们提出了一种非对称师生架构来解决这个问题。AST还引入了一种标准化流以避免这个问题，并防止由于两个网络结构的不一致性而引起的估计偏差。先前的师生网络架构异常检测方法由于神经网络容量与知识量之间的不一致性而导致过拟合。通过整合上下文相似性损失（CSL）和自适应硬样本挖掘（AHSM）模块，信息知识蒸馏（IKD）希望减少过拟合。CSL可以帮助学生网络理解包含上下文数据流形的结构。AHSM可以集中于包含大量信息的困难样本。

#### 2.1.2 单类分类 

单类分类技术更加依赖于异常样本。如果生成的异常样本质量较差，方法的性能将严重受损。如表3所示，除MemSeg外，其他方法的训练都依赖于SVDD和交叉熵损失。因此，绝大多数方法的性能都略显不足。 

异常检测也可以看作是一个单类分类（OCC）问题，这启发了一些研究。如图3所示，该方法在训练过程中找到一个超球体来区分正常样本特征和异常样本特征。在推理期间，该方法根据测试样本的特征和超球体的相对位置来确定样本是否异常。由于训练集不包含异常样本，一些方法人工创建异常样本以提高超球体的准确性。

SVDD是OCC问题中的经典算法，PatchSVDD、DSPSVDD和SE-SVDD将其改进用于工业图像AD。PatchSVDD将图像划分为均匀的补丁，并将其发送到模型进行训练，从而显著提高了模型检测异常的能力。DSPSVDD为深度SVDD模型设计了改进的综合优化目标，同时考虑了超球体体积最小化和网络重构误差最小化，以更有效地提取深层次的数据特征。SE-SVDD提出了一种语义相关模块（SCB），通过提取多层次特征来改进异常语义的表示和异常定位的准确性。

MOCCA利用多层次特征进行异常检测。与SE-SVDD不同，MOCCA使用自动编码器提取特征，并在每一层定位正常特征的边界位置。Sauter等人尝试使用Xception网络进行分类，并获得与SVDD相媲美的结果。FCDD采用全卷积神经网络进行OCC。由于每个图像层的特征相对位置在卷积过程中不会改变，所以FCDD产生的结果比其他方法更具解释性。

此外，Reiss和Hoshen[36]对PANDA中的灾难性遗忘问题进行了研究。他们提出了一种新的损失函数，能够克服中心损失和对比损失方法的失效模式，并用置信度不变的角度中心损失替换欧几里得距离以进行预测。DisAug CLR[27]提出了一个两阶段异常检测框架，第一阶段通过一种新颖的分布增强对比学习阻碍了对比表示的统一性。经过对比学习后，异常和正常样本的表示更容易区分。第二阶段利用第一阶段学习到的表示构建一个单类分类器。Yoa等人[32]提出了一种新颖的动态局部增强方法，用于从正常训练数据集生成负图像对，对异常检测有效。de Haan等人[33]利用对比预测编码(CPC)模型进行异常检测和分割，使用基于补丁的对比损失作为异常得分来定位异常。

此外，受显著性目标检测的启发，许多方法将显著性检测应用于异常检测。Bai等人[28]提出使用傅里叶变换来检测图像的显著区域，并将显著区域与模板进行比较以检测异常。Niu等人[29]利用显著性目标检测的方法获取对象轮廓，从而帮助检测异常。Qiu等人[30]提出了一种多尺度显著性检测(MSSD)方法，将前景和背景分离以获取粗略的异常区域，并在此基础上对检测结果进行细化。此外，GradCAM作为一种常见的获得显著性图的方法，也被用于各种异常检测算法中。CutPaste和CAVGA将异常检测视为分类问题，而GradCAM用于像素级异常定位。

CutPaste是一种以数据增强为基础的OCC方法的代表性示例。它通过切割和粘贴正常图像的部分来生成异常图像，使网络能够区分异常图像。此外，基于分割的方法也很有用。这种方法更加注重像素级别的异常定位。当流程已知时，Iquebal和Bukkapatnam[43]证明了图像标签的最大后验估计可以被表述为连续最大流问题。然后，通过在图像域上使用新颖的马尔科夫随机场迭代地获得流来完成异常分割。这种技术在金属添加制造异常检测数据集中表现出了其适应性。MemSeg在内存中存储正常图像的特征，以提高分割网络区分异常区域的能力。为了防止背景因素的影响，MemSeg只在物品的前景中引入外部数据集中的异常，这也是其表现优异的另一个原因。

#### 2.1.3 Distribution map

分布图方法需要一个适当的映射目标用于训练，选择映射方法会影响模型性能。分布图方法与基于OCC的方法非常相似，不同之处在于OCC方法专注于找到特征边界，而映射方法则试图将特征映射到所需的分布中。这类方法的常见框架如图4所示。这种期望分布通常是多变量高斯分布(MVG)。这种方法首先使用一个强大的预训练网络提取正常图像的特征，然后利用映射模块将提取的特征映射到高斯分布中。这种分布会偏离在评估过程中出现的异常图像的特征。可以根据偏差程度计算异常概率。

Tailanian等人提出了一个根据由补丁PCA和ResNet产生的特征图进行统计分析的相反框架，该框架在皮革样本上表现良好，用于检测图像中的异常。

根据生成式建模和判别式建模之间的关系，Rippel等人[47]生成了正常类别的多变量高斯分布，并证明了这一概念对于深度SVDD和FCDD的有效性，这减轻了先前研究中观察到的灾难性遗忘。PEDENet[48]框架由一个补丁嵌入(PE)网络、一个密度估计(DE)网络和一个位置预测(LP)网络组成。首先，PE模块用于减小预训练网络提取的特征的大小。然后，使用受高斯混合模型启发的DE模块和LP模块，模型可以预测补丁嵌入的相对位置，并基于推断期间预测结果与实际结果之间的差异来决定图像是否异常。预训练特征映射(PFM)[49]提出了双向和多层次双向预训练特征映射，以增强普通特征映射的性能。此外，Wan等人[50]在PFM框架中添加了位置编码，并提出了一种新颖的位置编码增强特征映射(PEFM)以进一步增强PFM。FYD[51]首次将注册引入工业图像AD中。FYD提出了一种从图像级别开始的从粗到细的对齐方法。接下来，在改进对齐阶段，使用非对比学习来增加批次中所有对应位置之间的特征的相似性。

标准化流(NF)[59]是通过一系列可逆映射来转换概率密度从而构建复杂分布的技术。NF方法从预训练模型（如ResNet或Swin Transformer）中提取正常图像的特征，并在训练阶段将特征分布转换为高斯分布。在测试阶段，在经过NF后，异常图像的特征将偏离训练阶段的高斯分布，这是区分异常的最重要原则。DifferNet[52]是首个利用NF来解决工业图像AD问题的研究。通过在标准化流中加入交叉卷积块来分配概率，CS-Flow[53]利用多尺度特征图内部和之间的上下文来改进DifferNet。CFlow-AD[54]在框架中添加了位置编码以实现条件标准化流，以获得更好的结果。此外，CFlow-AD[54]深入分析了为什么在早期模型中多元高斯假设是合理的优先考虑，并且为什么更通用的NF框架旨在以较少的计算达到相似的结果。FastFlow[57]在NF模块中引入了大、小卷积核的交替堆叠，以有效建模全局和局部分布。CAINNFlow[55]通过在NF模块中引入注意力机制CBAM[61]来提高模型的性能。在FastFlow和CFlow-AD等技术中，特征分布的中心不是0，它们的性能不稳定。Kim等人[62]提出了一个简单的解决方案AltUB[58]，它使用交替训练来更新标准化流的基本分布以用于异常检测以解决这个问题。AltUB验证了CFlow-AD和FastFlow的效果。

#### 2.1.4 Memory bank

记忆库方法通常不需要训练损失函数，模型构建速度快。它们的性能由强大的预训练网络和额外的记忆空间保证，这种方法目前在IAD任务中最为有效。记忆库方法与基于OCC的方法的主要区别在于，记忆库方法（如SVDD）需要额外的内存空间来存储图像特征。这些方法在推断时需要最小的网络训练，只需要对收集的正常图像特征进行采样或映射。在推断期间，将测试图像的特征与记忆库中的特征进行比较。测试图像的异常概率等于其与记忆库中正常特征的空间距离。

K最近邻（KNN）[72]是一种广泛使用的无监督异常检测算法，但它只在样本级别操作。语义金字塔异常检测（SPADE）[63]受KNN的启发，并利用基于多分辨率特征金字塔的对应关系来获取像素级别的异常分割结果。PaDim[73]利用多元高斯分布构建正常类的概率表示。因此，记忆库的大小仅由图像分辨率决定，而不是由训练集的大小决定。PaDiM需要批次逆多维协方差张量，这使得由于特征大小增加而难以将其扩展到更大的CNN。为了将逆的计算成本降低三分之一，Kim等人[62]将随机特征选择推广为半正交嵌入。与此同时，用于异常检测的自组织映射（SOMAD）[64]和GCPF[65]增强了正常特征的存储。SOMAD通过使用基于多尺度特征的拓扑记忆来保留正常特征。而GCPF则将标准特征转换为多个独立的多元高斯聚类。PatchCore[68]是工业图像AD领域的重大进步，极大地提高了MVTec AD的性能。PatchCore包含两个特殊点。首先，PatchCore的记忆库被核心子采样，以确保低推断成本同时最大化性能。然后，PatchCore根据测试样本在其记忆库中的最近邻特征与其他特征之间的距离确定测试样本是否异常。这个重新加权的过程使PatchCore更加稳健。自PatchCore提出以来，已经在其基础上开发了许多改进方法。Lee等人[69]提出了基于耦合超球体的特征适应（CFA），以获得面向目标的特征。通过迁移学习获得超球体的中心和表面，并利用测试特征与耦合超球体之间的位置关系来确定它是否异常。FAPM[70]由位于不同位置的许多基于补丁和基于层的记忆库组成。FAPM在推断期间独立地计算不同记忆库中的特征，从而显著加快了推断速度。

此外，使用目标像素与估计分布之间的马氏距离和欧几里得距离来推导异常得分。同样，Bae等人[71]使用位置信息作为条件概率来建模累积直方图，邻域信息用于建立正常特征分布。此外，该工作引入了异常检测和定位问题中的首个细化方法，利用合成异常图像改进基于输入图像的异常图，同时使用邻域和位置信息来估计分布。通过学习嵌入位置信息，并在推断期间将提取的特征与正常嵌入进行比较，Tsai等人[66]提出了一种改善网络表示数据能力的方法。它也基于自监督学习的概念。Zou等人[67]使用对比学习来训练主干网络，并提出了一种名为SPD的新数据增强方法，以推动网络区分具有轻微差异的两个图像。此外，他们利用PatchCore[68]展示了主干网络的表示能力。

### 2.2 基于重建的方法 

基于重建的方法主要通过自我训练编码器和解码器来重建图像进行异常检测，这使它们不太依赖预训练模型，并增强了它们检测异常的能力。然而，由于无法提取高级语义特征，其图像分类能力较差。如表 6 所示，各种方法的损失函数是可比的。然而，由于不同的重建模型范例和异常样本构造方法，它们的性能会有所不同。

重建技术的结构如图 6 所示。在训练过程中，将正常或异常图像送入重建网络，并使用重建损失函数来指导重建网络的训练。最后，重建网络可以以类似于原始正常图像的方式恢复重建图像。在推断阶段，比较模型将原始图像与重建图像进行比较以生成预测。与特征嵌入方法的多样性相比，大多数基于重建的方法仅在重建网络的构建上有所不同。由于其通过像素级比较来识别异常的能力，重建方法在像素级别表现优于特征嵌入方法。此外，大多数基于重建的方法是从头开始训练，而不使用稳健的预训练模型，这导致其性能较图像级特征嵌入方法较差。

#### 2.2.1 自编码器 

自编码器(AE)是最常见的用于AD的重建网络。许多其他重建网络也由编码器和解码器组件组成。Bergmann等人[75]研究了结构相似性指数(SSIM)和AE重建以及异常分割之间的影响，并为未来研究提供了许多建议。

如何解决重建图像与原始图像之间的差异是最基本的原则。重建图像与原始图像之间通常存在风格差异，导致过度检测。Chung等人[76]提出了一种暴露异常样式蒸馏网络(OE-SDN)，以保留AE的风格转换并抑制内容转换，以避免过度检测。

无监督两阶段异常检测（UTAD）[77]引入了IE-Net和Expert-Net来提取和利用印象，以获得无异常和高保真度的重建，从而提供了可解释性的框架。基于重建的方法在利用不同尺度的特征时几乎与特征嵌入方法一样有效。类似于师生架构，深度特征重建（DFR）[78]方法通过在特征级别进行重建来检测异常。DFR从经过预训练的网络中获取多个空间上下文感知的表示。然后，DFR使用深度但高效的卷积自动编码器进行特征重建，并通过将原始特征与重建特征进行比较来检测异常区域。闫等人[79]提出了一种新颖的多级图像重建（MLIR）框架，将重建过程形式化为不同分辨率下的图像去噪任务。因此，MLIR考虑了对全局结构异常和细节异常的检测。修改自动编码器的结构也可以提高其重建能力。周等人[80]引入了P-Net来比较原始和重建图像之间的结构差异。Collin和De Vleeschouwer[81]在编码器和解码器之间引入了跳跃连接以提高重建的清晰度。此外，他们提出用合成噪声来破坏它们以防止网络收敛地映射身份，他们引入了创新的污渍噪声模型。陶等人[82]也在特征级别操作。他们采用了密集特征融合模块，以获得双输入的密集特征表示，以帮助双孪生框架中的重建。侯等人[83]也使用跳跃连接来增强重建的质量。除了实现预期结果外，他们还添加了一个内存模块来跳跃连接。刘等人[84]通过灰度值边缘重建原始RGB图像，模型中的跳跃连接保留了图像的高频信息，以更好地指导重建。渐进式自动编码器（PAE）[85]通过渐进学习和修改的CutPaste增强来提高自动编码器的重建性能。在训练期间，PAE通过逐渐增加输入图像的分辨率来实现渐进学习。 掩模和修复是一种有效的自监督学习方法。李等人[86]开发了超像素掩蔽和修复（SMAI）技术。SMAI将图像分成多个超像素块，并训练修复模块在掩膜内重建一个超像素。在推理过程中，SMAI会逐个超像素地对测试图像进行掩蔽和修复，然后将重建图像与测试图像进行比较，以区分异常区域。I3AD是中西等人[88]提出的一种方法，它根据异常图来重建部分区域。I3AD通过仅在图像上重建修复掩模来提高重建质量，并仅掩盖高异常概率的区域。SSM[90]在概念上与I3AD类似。SSM在重建网络中添加了跳跃连接，并将掩膜区域预测为训练目标。RIAD[87]在补丁级别随机掩蔽训练集图像的一部分，并使用U-Net编码器-解码器网络对其进行重建。在推理过程中，RIAD组合多个随机掩膜和重建补丁以生成重建图像，然后将其与原始图像进行比较。多尺度梯度幅度相似性（MSGMS）在RIAD中作为异常分数表现出优于SSIM的性能。 DRAEM[91]代表了基于重建的技术。DRAEM通过引入外部数据集合成异常图像，并将其重建为正常图像，从而大大提高了重建网络的泛化能力。此外，DRAEM将原始图像和重建图像输入分割网络以预测异常区域，显著增强了模型对异常区域进行分割的能力。然而，DRAEM在合成接近分布的异常时容易失败。受显著性检测启发，邢等人[93]提出了显著性增强模块（SAM），以生成比DRAEM更真实的异常图像，从而获得更好的结果。DSR[94]提出了一种基于量化特征空间表示和双解码器的架构，以避免对图像级别异常生成的要求。通过在特征级别对学习的量化特征空间进行采样，接近分布的异常以受控方式生成。NSA[95]不使用外部数据进行数据增强，并采用更多的数据增强方法，使其胜过了所有以前没有使用额外数据集进行学习的方法。与试图将异常图像重建为正常图像的其他方法相反，Bauer[89]提出了将图像的异常区域重建，使其与原始图像的外观不同。这种方法产生了与其他方法相媲美的结果。 与经典的基于重建的方法相反，Ristea等人[96]提出将基于重建的功能整合到自监督预测卷积注意块（SSPCAB）中。SSPCAB可以集成到诸如DRAEM和CutPaste等模型中以增强这些模型。自监督掩膜卷积变换块（SSMCTB）[97]将SSPCAB中的SE层[115]转换为通道级变换块，并取得了更好的结果。 VAE是AE的一种变体，其中间变量与正态分布的数据有所不同。自然地，VAE具有更好的可解释性。Dehaene等人[98]通过渐变下降指导重建，其能量由重建损失定义，从而克服了VAE产生模糊重建的倾向，并保留了正常的高频结构。刘等人[99]通过训练注意解耦损失来训练变分自动编码器。在这种VAE中，异常输入会导致渐变反向传播和注意生成中的高斯偏离的潜在变量。这种偏离可用于定位异常。据Matsubara等人[100]称，数据集通常是异构的而不是规则的，非规则化的目标函数更适合在异构数据集上训练VAE模型。FAVAE[101]采用VAE来对预训练模型提取的特征分布进行建模，从而隐式地模拟更丰富的异常并增强模型的泛化能力。Wang等人[102]使用VQ-VAE创建离散潜在空间，重新采样离正态分布偏离的离散潜在代码，并使用重新采样的潜在代码重建图像。VQ-VAE重建的图像更接近于训练集的正常图像。

#### 2.2.2 Generative adversarial networks

基于生成对抗网络（GANs）的重建模型的稳定性不如自动编码器（AE）那么好，但是辨别网络对某些场景有更好的效果，描述如下。 在训练过程中，基于语义上下文的异常检测网络（SCADN）[103]对图像的一部分进行掩盖，并利用GAN进行重建。SCADN通过将输入图像与重建图像进行比较来推断异常。除了对图像进行掩盖外，AnoSeg[104]利用了硬增强、对抗学习和通道连接来生成异常样本。然后，AnoSeg训练GAN生成正常样本。AnoSeg与AE重建模型不同之处在于其目标函数包含了重建损失和对抗损失。OCR-GAN[105]利用频率解耦（FD）模块将图像解耦为不同频率的信息组合，然后重建并组合这些不同频率的信息以产生重建图像。在推理过程中，模型可以识别正常和异常图像频率分布之间的统计显著差异。

#### 2.2.3 Transformer 

Transformer具有更高的全局信息表示能力，这使得它有可能超越AE并成为异常检测的新重建网络基础。Mishra等人[106]提出了一个基于Transformer的框架，用于在patch级别重建图像，并采用高斯混合密度网络来定位异常区域。You等人[107]提出了用于重建预训练特征的ADTR。根据他们的说法，使用Transformer可以防止重建良好的异常，从而在重建失败时更容易识别异常。Lee和Kang[108]引入了基于视觉Transformer的编码器-解码器模型（AnoViT），并声称AnoViT在异常检测问题上优于基于CNN的-CAE。HaloAE[109]将Transformer实现到HaloNet中，并通过重建特征来实现图像重建，在MVTec AD数据集上取得了竞争性的结果。用于基于重建的异常检测的常见自监督学习方法是对掩码图像进行重建。然而，传统的CNN很难提取全局上下文信息。为了实现这一目标，Pirnay和Chai[110]提出了InTra，它将输入图像更大区域的信息整合到一起。InTra代表了从头开始训练的方法。Masked Swin Transformer Unet (MSTUnet)[111]与InTra相当，但是MSTUnet在模拟异常时采用了额外的增强措施，从而取得了更优秀的结果。De Nardin等人[112]使用邻域块来重建掩码块，并且也取得了强大的重建能力。

#### 2.2.4 Diffusion model 

扩散模型是一种最近流行的生成模型，也可用于基于重建的异常检测。AnoDDPM[113]据我们所知，是首个将扩散模型应用于工业图像异常检测的方法。与基于GAN的方法相比，使用简单噪声的AnoDDPM也能够捕捉大的异常区域，而无需大型数据集。当将扩散模型应用于异常检测时，Teng等人[114]主要进行了两项改进。作为重建损失的替代度量，使用了正常数据分布的时间依赖梯度值来测量缺陷。此外，他们开发了一种新的T-scales方法，以减少所需的迭代次数并加速推理过程。

## 3 监督异常检测 

尽管异常数据多样且难以收集，但在现实场景中仍然有可能收集到异常样本。因此，一些研究着重于如何使用少量异常样本和大量正常样本来训练异常检测模型。 Chu和Kitani[119]提出了一种半监督框架，用于在数据严重不平衡的情况下检测异常。他们假设在训练过程中损失值的变化可以用于识别异常数据作为特征。为了实现这一点，他们训练了一个基于强化学习的神经批处理采样器，以放大异常区域和非异常区域之间损失曲线的差异。FCDD[35]是一种无监督方法，用于合成用于训练OCC模型的异常样本。这个概念可以转移到其他OCC方法上。Venkataramanan等人[42]提出了一种具有引导注意力的卷积对抗变分自动编码器（CAVGA），它可以同样适用于存在和不存在异常图像的情况。在无监督设置中，CAVGA通过注意力扩展损失被引导关注图像的所有正常区域。在弱监督设置中，CAVGA使用互补的引导注意力损失来最小化对应于图像异常区域的注意力图，同时关注正常区域。Božič等人[120]研究了图像级别监督信息、混合监督信息和像素级别监督信息对同一深度学习框架中表面缺陷检测任务的影响。Božič等人[120]发现少量像素级别注释可以帮助模型实现与完全监督相媲美的性能。DevNet[121]使用少量异常样本实现了精细的端到端可微分学习。Wan等人[122]提出了一种适用于不平衡数据分布的训练的对数诱导损失（LIS），以及一种用于表征异常特征的异常捕获模块（ACM），以有效利用少量异常信息。DRA[123]提出了一个框架，用于学习可见、伪造和潜在残留异常的分离表示，以检测可见和不可见的异常。

此外，许多研究未考虑正常和异常样本的不平衡分布，并主要依赖异常样本进行监督训练。Sindagi和Srivastava[124]调查了各种设置中用于异常检测的数据集的域转移问题。Dual weighted PCA（DWPCA）是由Qiu等人[125]提出的一种用于图像配准和表面缺陷检测的算法。Bhattacharya等人[126]提出了一种交错的深度感知注意力机制（iDAAM），旨在分类异常图像中的多目标和多类缺陷。Zeng等人[127]将异常检测视为目标检测的一个子集，并设计了一种基于参考模板和上下文参考的基于参考的缺陷检测网络（RDDN）来检测异常。Song等人[128]将异常部分视为图像的显著区域，并提出了一种有效的显著性传播算法用于异常检测。Long等人[129]研究了触觉图像中的缺陷检测，这对于RGB图像中的织物结构缺陷检测具有明显的好处。此外，还有一些基于对象检测和语义分割模型的异常检测的修改模型在全监督下[132–134]。也有许多适用于异常检测的弱监督对象检测方法[135–138]。我们在这里不会逐一讨论它们。
  
## 4 工业制造场景 

本节介绍了更适用于工业场景的分类标准或应用设置，即小样本异常检测、嘈杂异常检测、异常合成和3D异常检测。 

### 4.1 小样本异常检测 

小样本学习对于数据收集和数据标注具有重要意义，这对实际应用有着巨大影响。一方面，通过研究小样本学习，我们可以减少工业产品数据收集和数据标注的成本。另一方面，我们可以从数据的角度解决问题，并研究什么样的数据对工业图像异常检测最有价值。小样本异常检测（FSAD）[139, 140]仍处于初级阶段。FSAD有两种设置。第一种设置是元学习[141]。换句话说，这种设置需要大量图像作为元训练数据集。Wu等人[139]提出了一种新颖的架构，称为MetaFormer，它利用元学习的参数实现了高模型适应能力和实例感知注意力来定位异常区域。RegAD[141]训练了一个用于检测类别无关异常的模型。在测试阶段，通过比较测试图像及其对应的正常图像的注册特征来识别异常。第二种设置依赖于普通的少样本图像学习。PatchCore[68]、SPADE[63]和PaDim[73]对16个正常训练样本进行了消融研究。然而，它们都不专注于小样本异常检测。因此，有必要开发专注于本地小样本异常检测任务的新算法。 最近，研究人员将零样本异常检测（ZSAD）设置扩展到了FSAD设置之外。ZSAD的目标是利用大型模型的泛化能力，在不需要任何训练的情况下解决异常检测问题，从而完全消除数据收集和标注的成本。MAEDAY[142]使用了一个预训练的掩码自动编码器（MAE）[143]来解决这个问题。MAEDAY随机遮罩图像的部分区域，并使用MAE恢复它们。如果重建区域与遮罩前的区域不同，则将该区域视为异常。WinCLIP[144]利用另一个名为CLIP的大型模型[145]进行ZSAD。基本上，WinCLIP使用CLIP的图像编码器提取图像特征。给定文本描述，如“一个受损物体的照片”，WinCLIP使用CLIP的文本编码器提取这些描述的特征，然后计算文本特征与图像特征之间的相似性。如果相似度高，则图像是“受损物体的照片”，否则图像是正常的。MAEDAY和WinCLIP表明，零样本异常检测是一个有前景的研究方向。 

### 4.2 嘈杂异常检测 

在异常检测中，嘈杂学习是一个经典问题。通过研究嘈杂学习下的异常检测，我们可以避免由标签错误引起的性能损失，并减少异常检测中的误报。Tan等人[146]采用一种新颖的信任区域内存更新方案，将噪声特征点与内存库分开。Yoon等人[147]使用一种数据精炼方法来提高单类别分类模型的鲁棒性。Qiu等人[148]提出了一种在存在未标记异常的情况下训练异常检测器的策略，该策略适用于广泛的模型类别。他们通过合成标记异常数据，并联合优化损失函数和正常数据以及合成异常数据。Chen等人[149]引入了一个插值高斯描述符，该描述符学习了一个与对抗插值训练样本训练的单类别高斯异常分类器。然而，前述大多数方法尚未在真实的工业图像数据集上进行验证。换句话说，现有的异常检测方法的有效性可能不适用于工业制造。 

### 4.3 3D 异常检测 

3D 异常检测可以利用更多的空间信息，从而检测一些在 RGB 图像中无法包含的信息。在一些特殊的光照环境或对于一些不敏感于颜色信息的异常情况下，3D 异常检测可以展现出它的显著优势。这个研究方向目前在学术界受到了广泛关注。自从发布了 MVTec 3D-AD[6]数据集以来，有几篇论文专注于 3D 工业图像的异常检测。Bergmann和Sattlegger[150]引入了一种用于 3D 异常检测的师生模型。教师网络通过重新创建局部感受域来获得一般局部几何描述符的训练。而学生网络则被教导匹配预训练教师网络的局部 3D 描述符。Horwitz 和 Hoshen[151]提出了一种称为 BTF 的方法，将手工制作的 3D 表示（FPFH[152]）与 2D 特征的表示方法（PatchCore[68]）相结合。Reiss等人[153]提出，自监督学习的表示能力暂时不如手工制作的特征用于 3D 异常检测。然而，如果有大规模的 3D 异常检测数据集可用，自监督表征仍然有很大的潜力。AST[16]利用带深度信息的 RGB 图像增强了异常检测性能。然而，大多数 3D IAD 方法专门针对 RGB-D 图像，而实际工业制造中的 3D 数据集由点云组成，这意味着当前的 3D IAD 方法无法直接部署到工业制造中。因此，仍然存在着 3D IAD 的进一步发展机会。 

### 4.4 异常合成 

通过人工合成异常，我们可以提高具有有限数据的模型性能。这项研究是对小样本研究的补充。小样本学习研究如何在数据固定时提高模型，而这项研究则研究如何在模型固定时人工增加可信数据以提高模型性能。这两种方法都可以降低数据收集和标注的成本。有许多无监督的异常检测作品利用数据增强来合成异常图像，并显著提高模型性能。例如，CutPaste[31]、DRAEM[91]、MemSeg[18]是代表性方法。此外，一些监督方法使用有限的异常样本合成更多的异常样本进行训练。Liu等人[154]提出了一种专门用于在无缺陷的织物图像上生成缺陷的模型，用于语义分割的训练。而Rippel等人[155]使用了包含 ResNet/U-Net 的 CycleGAN[156]作为生成器的基本架构，将一个织物中的缺陷转移到另一个织物中。通过改进风格转移网络，SDGAN[157]实现了比 CycleGAN 更好的结果。Wei等人[158]提出了一个名为DST的模型来模拟缺陷样本。首先，DST在非缺陷图像上生成一个空白遮罩区域，然后DST使用遮罩直方图匹配模块将空白遮罩区域的颜色与图像的整体颜色一致，并最终使用 U-NET 进行风格转移，使生成的图像更加逼真。Wei等人[159]提出了一个名为DSS的模型，该模型使用传统的 GAN 在无缺陷样本的指定区域中重构缺陷结构，然后使用 DST 进行风格转移将模拟的缺陷融入背景。Jain等人[160]尝试使用 DCGAN、ACGCN 和 InfoGAN 通过添加噪声生成缺陷图像，从而提高分类的准确性。Wang等人[161]基于 StarGANv2 提出了 DTGAN，它添加了前景-背景解耦，并实现了一定程度的样式控制，并使用 Frechet inception 距离（FID[162]）和核 inception 距离（KID[163]）来评估图像生成的质量。DefectGAN[164]也认为，缺陷和正常背景可以分层，并且缺陷是前景。DefectGAN通过风格转移以样式转移的形式生成缺陷前景及其空间分布。尽管这个领域有大量的研究，但与其他已经有明确方向的领域不同，它仍然存在着相当大的发展潜力。

## 5 Datasets and metrics

【数据集】数据是机器学习的关键驱动因素，特别是对于深度学习而言。主要来说，获取工业照片的困难阻碍了工业视觉图像异常检测的发展。表7显示工业图像异常检测数据集的数量和规模逐渐增加，但其中大多数并非在真实生产线上生成。一个有前景的替代方法是充分利用工业模拟器生成异常图像，可能缩小学术研究与工业制造需求之间的差距。

【指标】表8全面审查了工业图像异常检测中的指标。第一列表示指标的名称，第二列表示级别。换句话说，如果级别升高，指标值越大，性能越好。如果级别降低，指标值越小，性能越好。第三列详细说明了每个指标，特别是指标如何准确地指示图像异常检测的性能。从表8中可以很容易地观察到，大多数新型指标都是自然图像分割和检测指标的变体，例如 F1 分数、AU-ROC 或 AU-PR。

## 6 总体性能分析 

表9和表10展示了当前在MVTec AD上的工业图像异常检测性能的统计结果。图7支持了表9的结果：即使不同的方法在图像分类方面表现相似，但在像素级别分割方面仍存在显著差异。我们对当前工业图像异常检测方法的性能进行了深入分析，并提供了以下有意义的见解： 

1）关于图像级别异常检测任务的识别，基于记忆库的方法是最有效的神经网络设计。然而，它们在检测像素级别异常方面不足够。 

2）集成学习可以显著提高最先进的异常检测方法的性能。 

3）SSPCAB能够无缝集成到最新的方法中，并显著提升基于重建的方法的性能。 

4）少样本IAD和普通IAD之间的差距正在缩小。换句话说，我们可以利用数据蒸馏算法降低用于异常检测的数据集数量。 

5）在没有使用集成学习的情况下，MemSeg在图像级别异常分类上取得了SOTA结果，这主要是由于使用了U-Net框架。DRAEM也使用U-Net在像素级别异常分割上胜过其他方法。MemSeg和DRAEM的有效性表明了异常检测中分割模块的优越性。人工监督通常不如真实监督，训练有人工监督的分割模型通常性能更差。然而，即使使用人工生成的异常作为监督信息，这些带有分割模块的方法在分类和分割任务上仍然优于其他不带分割模块的方法。我们可以得出结论，分割模块对于异常检测任务是有益的。 

6）对于分割任务，AU-PR比AU-ROC更有价值。如表10所示，基于重建的方法在像素级AU-PR指标上胜过其他方法。至于图7，DRAEM的检测结果最接近实际情况。这导致了更锐利的边缘和更少的错误检测区域。我们可以从统计数据和可视化中推断出，基于重建的方法更适合分割任务。 

## 7 未来的方向 

我们概述了几个有趣的未来方向如下： 

1）我们应该建立一个多模态IAD数据集。在实际的装配线上，RGB图像不足以检测异常。因此，我们可以利用额外的模态信息，例如X射线和超声波，以提高异常检测性能。 

2）鉴于测试样本是依次流经生产线的，大多数IAD方法都无法在新的测试样本到达时进行即时预测。在工业制造中，除了准确性之外，IAD的推理速度也应该得到解决。采用多目标进化神经结构搜索算法来找到最佳权衡体系结构是一种有前景的方法。 

3）大多数IAD方法使用ImageNet预训练模型从工业图像中提取特征，这必然会导致特征漂移问题。因此，迫切需要构建用于工业图像的预训练模型。 

4）大多数异常检测方法集中在无监督设置上。尽管这种设置可以降低数据标注的成本，但它极大地抑制了基于分割的方法的发展。无监督方法和监督方法应该相辅相成，近年来监督方法发展缓慢的主要原因是缺乏大量标记数据集。因此，未来有必要提出一个带有像素级注释的完全监督的异常检测数据集。 

5）以前，我们专注于为正常图像开发数据增强方法。然而，我们在通过数据增强合成异常样本方面付出了不多的努力。在工业制造中，由于大多数生产线都是无故障的，很难收集大量异常样本。因此，未来应该更加关注异常合成方法，如CutPaste、DRAEM和MemSeg等。 

6）当前的异常检测算法通常关注检测准确性，而忽视了模型的存储大小和效率。这导致了高计算成本，并限制了异常检测应用于企业生产的末端。因此，有必要设计轻量但高效的异常检测模型。 

7）目前，图像异常检测算法主要可以分为两个任务：工业图像异常检测和医学图像异常检测。尽管医学图像比工业图像具有更多的模态，但这两个任务在数据和实验设置方面有许多相似之处。然而，很少有研究探讨如何统一这两个任务。其中一个原因是医学和工业图像数据集之间的领域差异，另一个原因是缺乏良好的基线和比较基准。

## 结论

在本文中，我们对工业制造中的图像异常检测进行了文献综述，重点关注了监督级别、神经网络架构设计、数据集类型和属性以及评估指标。特别是，我们对工业制造中的有前景的设置进行了表征，并审视了我们提出的设置下当前的图像异常检测算法。此外，我们深入研究了哪些网络架构设计可以显著提高异常检测性能。最后，我们指出了图像异常检测的几个令人兴奋的未来研究方向。