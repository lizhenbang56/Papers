---
Url: https://arxiv.org/pdf/2301.13359.pdf
代码: https://github.com/M-3LAB/open-iad
Stars: "69"
Year: "2023"
Month: "01"
Title: "IM-IAD: Industrial Image Anomaly Detection\r Benchmark in Manufacturing"
Publish: TCYB2024
---
  
## 摘要

图像异常检测（IAD）是工业制造（IM）中一项新兴而重要的计算机视觉任务。近年来，已经报道了许多先进的算法，但它们的性能在各种不同的IM设置下存在明显的偏差。我们认识到缺乏统一的IM基准正在阻碍IAD方法在实际应用中的发展和使用。此外，没有统一的基准，研究人员很难分析IAD算法。为了解决这个问题，我们首次提出了一个统一的IM基准，以评估这些算法的性能如何，该基准包括各种监督程度（无监督与完全监督）、学习范式（少样本、持续和噪声标签）和效率（内存使用和推理速度）。然后，我们构建了一个全面的图像异常检测基准（IM-IAD），该基准包括七个主要数据集上的19种算法，采用统一的设置。对IM-IAD进行了广泛的实验（总计17,017个），为IAD算法的重新设计或选择提供了深入洞察。此外，所提出的IM-IAD基准挑战了现有的算法，并提出了未来的研究方向。为了可重现性和可访问性，源代码已上传到网站：[https://github.com/M3LAB/open-iad](https://github.com/M3LAB/open-iad)

## I. 引言 

IAD是工业制造（IM）应用中重要的计算机视觉任务，例如工业产品表面异常检测、纺织品缺陷检测和食品检查。然而，在实际工业制造中很少使用IAD算法，急需一个统一的图像异常检测（IAD）基准来弥合学术研究与实际应用之间的差距。尽管如此，当前计算机视觉社区的研究主要集中在无监督学习上，对行业需求的分析付出了很少的努力。

所提出的IM-IAD旨在推动IAD方法在实际场景中的边界，因为现有的基准无法准确反映IM的需求。有两个值得注意的工作[103]，[33]致力于基准IAD算法。IM-IAD与现有基准的区别在于以下几个方面。首先，先前的研究主要集中在根据监督程度对IAD方法进行基准测试[33]。然而，这些工作[33]，[103]忽略了现实中的IM需求，例如持续IAD、少样本IAD和噪声标签IAD以及精度和效率之间的权衡。这是至关重要的，因为大多数现有的IAD算法无法满足IM的上述要求。有几个原因。首先，IAD算法优先考虑更高的准确性，但忽略了推理速度和GPU内存大小，这阻碍了工厂中使用IAD算法。其次，由于商业隐私，很难收集到大量的正常样本用于训练；如果训练样本数量有限，IAD算法的性能几乎无法满足IM的要求。第三，大多数现有的IAD算法在不具备持续学习能力的情况下会遭受灾难性遗忘。最后，由于缺陷的微小尺寸，错误的标注不可避免地会发生。因此，训练数据集中的一些异常样本被标记为正常。嘈杂的训练数据集将导致算法性能下降。但大多数现有的IAD算法并不考虑噪声标注问题。因此，我们提出的IM-IAD使研究人员意识到学术界与行业之间的差距，并为未来的改进提供了更深入的见解。其次，ADBench [33]主要关注表格和图形结构化数据，而不是图像数据，并且没有对基准进行IAD算法的评估。例如，在最近的工作[103]中，作者仅在两个数据集上评估了无监督的IAD算法。相比之下，我们构建了一个全面的基准，IM-IAD，使用七个工业数据集和19种算法，如表II所示。

在本文中，我们通过大量实验解决了上述IAD中的问题。主要的发现如下。1）就准确性、内存使用和推理速度而言，基准测试的无监督IAD算法没有一种在统计学上显着优于其他算法，突显了选择异常类型的重要性。2）长距离注意力机制在逻辑IAD中显示出巨大潜力，可能是由于其全局特征提取能力。3）与无监督IAD相比，全监督方法表现出更优异的性能。这可以归因于将标记的异常合并到训练过程中显著增强了IAD的能力。4）仅仅使用4个增强（旋转）数据，基于特征嵌入的少样本IAD算法可以实现与基准IAD 95%的性能，揭示了数据特性的必要性。5）重要性重新加权成功提高了IAD算法的鲁棒性，即使噪声比率大于10%。6）内存银行可以无缝地融入先进的IAD算法中，极大地增强了其抵抗灾难性遗忘的能力。

主要贡献总结如下。 • 我们从制造过程中提取了科学问题，并提出了一个标准化和统一的基准，以弥合学术研究与工业实践在识别图像异常方面的差距。 • 我们在7个基准数据集上检验了16种IAD方法，共计17,017个实例。此外，我们提出了一个即插即用的、模块化的实现，以公平地评估IAD算法，这对未来的IAD算法的发展大有裨益。 • 通过分析研究和工业制造过程的需求，我们比较了IAD算法的四个关键方面：基于变换的少样本表征能力、精度和效率之间的权衡、灾难性遗忘现象以及算法在存在噪声标注时的鲁棒性。基于这些方面，我们提供了深刻的见解，并提出了未来的方向。

本文的其余部分组织如下。第二节介绍了有关IAD方法和主流学习范式的文献综述。第三节提供了我们提出的统一基准IM-IAD。具体而言，我们在第四节对实验进行了全面评估，并讨论了各种IM场景中的高级模型性能。最后，第五节总结了我们的工作。

## II. 相关工作 

本节回顾了当前IAD方法，表I总结了这些方法，并在图1中可视化了五种设置，这些设置在第III节A中定义。

【无监督IAD】无监督IAD有两种方法流[52]，即基于特征嵌入的方法[4]，[69]，[16]，[9]，以及基于重建的方法[88]，[97]，[102]。具体来说，基于特征嵌入的方法可以分为四类，包括师生模型[4]，归一化流[69]，记忆银行[16]和单类分类[76]。最典型的方法是师生模型和记忆银行模型。对于师生模型，师模型在训练阶段提取正常样本的特征，并在训练过程中向学生模型灌输知识。对于异常图像，在测试阶段，师网络提取的特征可能会与学生网络不同。因此，寻找异常的基本规则是师生网络具有不同的特征。关于记忆银行的方法[16]，[50]，[43]，模型捕捉正常图像的特征并将其存储在特征记忆库中。在测试阶段，测试样本的特征查询存储器，以获取最近邻居的特征点。如果测试特征与最近邻居的特征点之间的距离超过特定阈值，则测试样本异常。然而，这两种方法都严重依赖于师网络的能力或记忆银行的大小，这可能会限制在实际工业中的泛化能力。近年来，重建方法，从使用自动编码器[6]，[97]，[11]到生成对抗网络[86]，[28]，再到Transformer[94]，[89]和扩散模型[56]，[102]，已被广泛应用。这些方法需要大量的训练时间。然而，它们的性能仍然落后于基于特征嵌入的方法，使得满足实际工业生产需求变得具有挑战性。

【完全监督IAD】关于设置，无监督IAD和完全监督IAD [49]，[15]，[26]之间的区别在于是否使用异常图像进行训练。完全监督IAD方法[80]，[61]专注于有效地利用少量异常样本来区分异常特征和正常样本的特征。然而，一些完全监督IAD方法的性能不如无监督方法用于识别异常。在使用异常样本的数据方面仍有很大的改进空间。

【少样本IAD】少样本（包括零样本）IAD非常有前景。然而，少样本IAD仍处于初级阶段。GraphCore [84] 设计了高效的视觉等距不变特征，用于少样本任务，能够进行快速训练，并显著提高使用少量样本区分异常的能力。FastRecon [29] 在推断过程中存储正常样本的特征，以辅助图像重建，使得在少样本学习场景下可以训练重建网络。WinCLIP [38] 将特征比较方法扩展到零样本场景。它使用CLIP [64] 提取正常或异常描述的文本特征，然后将其与测试图像特征进行比较，以进行异常检测。此外，通过利用基于多模态的基础模型（如Segment Anything [44]）对异常的多样化先验知识，Cao等人 [8] 在零样本设置中在几个基准上取得了可比较的性能。最近，AnoVL [25] 和AnomalyGPT [31] 利用视觉语言模型的理解能力在零样本场景下取得了新的最先进结果，但这些模型的规模太大，无法部署在实际的生产线上。由于工业场景的实际需求，少样本学习仍然是未来异常检测的研究重点。

【嘈杂IAD】噪声学习是异常检测的经典问题[63]，[12]。然而，在IAD领域，用嘈杂数据进行训练是实践中不可避免的问题。这种噪声通常来自固有的数据转移或人为判断错误。为了解决这个问题，SoftPatch [41] 是第一个以无监督方式在补丁级别高效去噪的方法。InReaCh [58] 通过学习图像内部关系增强了模型的表征能力。即使在人为损坏的数据上进行训练，它也可以达到接近SOTA的结果。相比之下，其他方法很少讨论这种情况。噪声数据的IAD需要未来更多的研究。

【持续IAD】随着异常检测的发展，整合持续学习（CL）的工作正在增加。第一个用于工业IAD的CL基准是由李等人 [51] 提出的，但他们的设置忽略了不同数据集之间的大领域差距。LeMO [30] 关注类内持续学习的问题，然而，它忽略了类间遗忘的问题。为了进一步探索IAD方法的能力，应在这种设置下进行更多努力。

## III. IM-IAD

在本节中，我们首先介绍了IM-IAD中五种设置的定义，然后总结了基线方法、主流数据集、评估指标和超参数的实现细节。最后，我们指出了从统一的视角研究IM-IAD的重要性。

  
### A. 问题定义 

IAD的目标是，给定来自目标类别的正常或异常样本，异常检测模型应该预测图像是否异常，并在预测结果为异常时定位异常区域。我们提供以下五种设置。

1. 无监督IAD。训练集仅包含每个类别的m个正常样本。测试集包含正常和异常样本。
2. 完全监督IAD。训练集包含m个正常样本和n个异常样本，其中n ≪ m。在我们的情况下，我们将n设定为10。
3. 少样本IAD。给定仅包含m个正常样本的训练集，其中m ≤ 8，来自某个类别。目标类别的m的数量分别可以为1、2、4和8。
4. 噪声IAD。给定包含m个正常样本和n个异常样本的训练集，其中n最多占m+n的20%。在训练数据集中，将n个异常样本标记为正常样本。
5. 持续IAD。给定由n个类别的有限训练数据集T total train组成的有限序列，T total train = T 1 train, T 2 train, · · · , T n train，即T total train = Sn i=1 T i train，其中子集T i train包含来自某个特定类别ci的正常样本，i ∈ n。在CL场景中，IAD算法对每个类别数据集T i train进行一次训练。在测试期间，更新的模型在以前的数据集T total test的每个类别上进行评估，即T total test = T 1 test, T 2 test, · · · , T i−1 test，分别。

### B. 实现细节

1. 基线方法：表II列出了16种IAD算法（以紫色标记）。在IM-IAD中选择要实施的算法的标准是，这些算法在监督级别（完全监督和无监督）、噪声鲁棒性能、数据高效适应性（少样本）和克服灾难性遗忘的能力方面应具有代表性。由于其中大多数在大多数工业图像数据集上都取得了最先进（SOTA）的性能，因此它们被称为基准方法，并在IM设置中进行比较。
2. 数据集：为了进行全面的消融研究，我们在IM-IAD中使用了七个公共数据集，包括MVTec AD、MVTec LOCO-AD、MPDD、BTAD、VisA、MTD和DAGM。表III提供了这些数据集的概述，包括样本数量（正常和异常样本）、类别数量、异常类型和图像分辨率。所有数据集都提供了像素级注释。请注意，DAGM是一个合成数据集，MVTec LOCO-AD提出了逻辑IAD，而VisA提出了多实例IAD。

3.  评估指标：在结构异常方面，我们采用接收器操作特性曲线下的面积（AU-ROC/AUC）、Precision-Recall曲线下的面积（AUPR/AP）和PRO [1] 来评估异常定位的能力。关于逻辑异常，我们采用sPRO [5] 来衡量逻辑缺陷检测的能力。此外，我们使用遗忘度量（FM） [10] 来评估抵抗灾难性遗忘的能力。相关公式如表IV所示。

5. 超参数：表V显示了IM-IAD的超参数设置，包括训练时期、批量大小、图像大小和学习率等。我们在网站 [https://github.com/M-3LAB/open-iad](https://github.com/M-3LAB/open-iad) 上共享了源代码。
  

### C. 统一视角 

所提出的IM-IAD连接了不同的现有设置，因为没有统一的评估基准。

1. 从训练数据集的角度来看，图1中显示的五种设置之间的主要差异在于训练样本的类型和数量。值得注意的是，无监督IAD算法仅使用正常数据集进行训练。少样本IAD使用有限数量的正常样本（≤ 8）进行训练。  
2. 从应用的角度来看，IM-IAD旨在适应实际生产线中的不同场景。由于收集许多异常样本用于训练很困难，无监督IAD是为了通过仅使用正常训练样本来设计一般情况。少样本IAD旨在解决单个装配线场景中冷启动的挑战，其中正常样本有限。连续IAD的目标是解决当IAD模型集成到回收装配线时发生的灾难性遗忘。嘈杂的IAD试图消除由污染的训练数据导致的副作用。全监督IAD旨在提高异常样本利用效率，因为标记异常很昂贵。  

### D. 开放挑战  

关于IM-IAD中的设置，以下是需要研究的挑战性问题的总结。

1. 对于完全监督的IAD[26]，[49]中描述的剩余挑战如图1(c)所示，关键是如何有效地利用有限的异常数据和大量的正常样本的指导来检测异常。
2. 对于图1(d)中显示的少样本IAD，我们的目标是使用训练集中少量的正常或异常图像来检测测试集中的异常。主要障碍包括：i) 在少样本设置中，每个类别的训练数据集仅包含正常样本，这意味着没有图像或像素级别的注释。ii) 训练集中只有少量的正常样本。在我们提出的设置中，每个类别的训练样本少于8个。
3. 我们尝试在存在噪声的情况下，对给定目标类别的IAD进行异常样本检测和异常识别。例如，假定清洁的训练数据仅包含正常样本。而污染的训练数据包含错误标记为正常的噪声样本，即标签翻转。由于异常太小而无法识别，异常样本很容易被错误标记为正常。最显着的障碍总结如下。i) 每个类别的训练集包含可能会混淆IAD算法决策阈值的噪声数据。ii) 存在大量的噪声数据。在这里，训练集中异常样本的百分比范围从5%到20%。因此，嘈杂的IAD旨在评估当前无监督IAD方法在存在污染数据时的弹性。
4. 对于图1(f)中呈现的连续IAD，最大的挑战是当IAD算法完成对新类别数据集的训练后可能会遭受灾难性遗忘。在实际应用中，单个装配线通常容纳大量工件，通常包含成千上万个。由于维护所带来的高昂费用，将大量的IAD模型部署到单个装配线上是不可行的。此外，装配线过程的大部分涉及回收。因此，工业部署需要IAD模型克服灾难性遗忘。  

## IV. 结果和讨论

本节探讨了现有算法，并讨论了所提出的统一设置的关键方面。每个部分都描述了实验设施，分析了结果，并提供了其他挑战和未来方向。  

### A. 总体比较

【设置】表II中介绍了基准方法。无监督设置见Sec. III-A-1。

【讨论】表VI的统计结果表明，在所有数据集中都没有普遍的获胜者。此外，图2(a)和图2(b)显示，在GPU准确性、推断速度和内存方面没有统治性的解决方案。具体来说，表VI表明，PatchCore，作为最先进的基于内存银行的方法之一，在MVTec AD上的表现优于MVTec LOCO-AD。因为PatchCore架构专门针对结构异常，而不是逻辑异常，MVTec AD和MVTec LOCO-AD之间的主要区别在于异常类型。

【逻辑异常定义】MVTec LOCO-AD包含结构和逻辑异常。逻辑异常不是凹陷或划痕，而是由位移或缺失部件引起的。然而，MVTec AD只有结构异常。对于可视化结果，图3展示了每个IAD模型对不同类型异常的限制。例如，第五列的图像是螺丝袋，它们的缺陷是逻辑异常。特别是，每个非有缺陷的螺丝袋的箱子中都只包含一个图钉。然而，有缺陷的螺丝袋在箱子右上角包含两个图钉。PatchCore热图无法准确表示右侧的异常，即RD4AD可以精确识别右上角的逻辑异常。

【内存使用和推断速度】从图2可以看出，在准确性、内存使用和推断时间方面，没有统治性的IAD方法。PatchCore在图像AUROC方面表现出色，但在内存使用和推断时间方面没有优势。在实际场景中，必须充分考虑内存使用和推断速度。因此，当前先进的IAD算法无法满足IM的要求。

【图像级别还是像素级别的评估？】研究人员通常使用图像级别和像素级别的指标来评估IAD算法的分类性能。在实践中，图像级别的指标用于判断整个产品是否异常，而像素级别的指标则表示异常定位性能。具体来说，像素级别的指标可以评估缺陷的程度，这与产品的价格密切相关。根据表VI，特定的IAD方法，如PatchCore，在图像AUROC上表现良好，但在像素AP上表现不佳，反之亦然。这两种类型的指标表示IAD算法的不同能力，并且对IM都非常重要。因此，必须开发出在图像级别指标和像素级别指标方面表现出色的创新IAD算法。

【挑战】我们如何使用视觉异常的类型有效地选择和设计无监督算法？基于异常类型的算法选择至关重要，但在这个领域缺乏研究。由于产品线专家可以提供有关异常类型的信息，因此提前了解异常类型是适当的。换句话说，在无监督算法中了解异常类型可以被视为监督信息。因此，算法设计者在开发算法时应考虑异常类型。  

### B. 全局特征在逻辑IAD中的作用  

【设置】我们在MVTec LOCO-AD数据集上对基准无监督IAD算法进行了基准测试。此外，我们重新实现了基线逻辑AD方法GCAD。

【讨论】根据表VII，基线方法GCAD优于所有无监督IAD方法。GCAD的关键思想是通过瓶颈架构将每个像素的特征描述符编码为全局特征。现有的无监督IAD方法的缺点是它们的架构未经优化，无法获得全局特征。

【挑战】全局特征提取对于实现逻辑IAD任务的高检测性能至关重要。表VII中的统计结果突出了全局异常特征提取的重要性。最近的网络架构，如Transformer和Normalizing Flow，专注于长距离特征提取，这使得检测逻辑异常变得更容易。此外，瓶颈架构是另一种捕获全局特征的可行方法。正如图3中逻辑异常数据集的热图所示，RD4AD的瓶颈设计能够提取全局特征。

### C. 完全监督IAD中的异常数据 

【设置】我们首先根据[61]、[13]、[49]中的设置对完全监督IAD方法进行基准测试。根据III-A-2节中对完全监督IAD的定义，我们将异常训练样本的数量设置为10。在这里，我们将PRN、BGAD、DevNet、DRA、SemiREST和PatchCore等算法进行比较。

【讨论】完全监督IAD算法利用测试样本与训练样本之间的距离来预测异常。其核心思想是异常和正常样本的特征非常不同。例如，DevNet提出使用偏差损失函数来强制所有异常与正常样本的统计偏差。从表VIII可以看出，完全监督IAD方法在像素级别的性能远远超过了无监督方法（如PatchCore）。这证明了将异常样本纳入训练的有效性。

【挑战】提高完全监督IAD方法中异常样本的有效性至关重要。

### D. 基于特征嵌入的少样本IAD的旋转增强 

【设置】在训练样本方面，我们选择了1、2、4和8来对基准IAD方法进行评估。详细信息可以在III-A-3节的少样本设置中找到。此外，我们还将与RegAD进行比较，后者是一种先进的元学习方法。

【讨论】图4显示，CutPaste、STPM和PatchCore的性能与基准模型RegAD相当。受[60]和[14]的启发，我们尝试使用数据增强来提高IM少样本设置中的性能。表IX的统计结果表明，大多数数据增强方法都足以改善少样本IAD的性能。此外，我们发现旋转是一种最优的增强方法，因为大多数实时工业图像[3]、[39]可以通过旋转转换为另一张图像，比如金属螺母和螺丝。

【挑战】合成异常样本至关重要但又很困难。以前，研究人员专注于开发用于正常图像的数据增强方法。然而，很少有人会努力合成异常样本。由于工业环境中的无故障生产线，收集大量异常样本非常困难。在未来，应更多地关注异常合成方法，例如CutPaste和DRAEM。

### E. 对嘈杂IAD的重要性重新加权 

【设置】根据III-A-4节介绍的噪声设置，我们通过向原始测试集注入各种异常样本来创建一个嘈杂标签训练数据集。具体而言，我们借鉴了SoftPatch的设置。异常样本主要占据了所有训练数据的20%（称为噪声比例）。噪声比例为5%至20%，步长为5%。由于测试类别的规模有限，我们选择了测试数据集中最多75%的异常样本的训练样本。在训练阶段，所有训练数据集中观察到的标签都是正常的。在测试阶段，不再评估异常样本。在噪声设置中，我们将基准和嘈杂IAD基线方法IGD进行了基准测试。

【讨论】根据表X中呈现的统计结果，发现基于特征嵌入的方法在处理有限噪声水平（≤0.15）时比IGD更有效。

Challenges. 样本选择对提高IAD的鲁棒性至关重要。在未来，样本选择具有极大的潜力，因为它可以与当前的IAD方法无缝集成。例如，Song等人创建了一个区分网络，用于区分真实标记的情况和嘈杂的训练数据，即一个用于样本选择，另一个用于异常检测。

### F. 基于存储库的方法用于连续IAD 

【设置】我们根据III-A-5节的连续设置，对基准方法和连续基线IAD方法DNE进行了基准测试。

【讨论】表XI表明，基于存储库的方法在所有无监督IAD中提供了令人满意的性能，以克服灾难性遗忘问题，尽管这些方法并没有明确针对连续IAD设置提出。其主要思想是，重播方法非常适用于基于存储的IAD算法。基于存储库的方法可以轻松添加新的存储器，以减少在学习新任务时的遗忘。理想情况下，存储库应适用于测试机制。在测试期间，基于存储库的方法可以轻松地将最近均值分类器与提供测试样本时的最近存储器相结合，以定位最近的存储器。

【挑战】在连续IAD设置中，限制存储数据库的大小并最小化来自先前任务的干扰至关重要。在学习新任务时，简单地添加更多存储器会显著减慢推断时间并增加存储使用量。对于固定的存储需求，我们建议使用存储采样来限制可以存储的实例数量。此外，新任务的存储器可能与先前任务的存储器重叠，导致IAD性能下降。因此，主要挑战在于设计新的约束优化损失函数，以避免任务干扰。

### G. 对IM-IAD的统一视角 

【设置】我们在统一设置中对基准算法进行了基准测试，包括少样本、嘈杂和连续设置，这些设置在III-A节中有描述。

【讨论】表XIII显示，PatchCore在IM-IAD中取得了SOTA结果。然而，如图2所示，PatchCore在GPU存储器使用和推断时间方面不如其他IAD算法，使其在实际情况下的使用具有挑战性。此外，如果对象类别的数量超过100个，则维护存储库的大小是实际部署的关键问题。因此，要弥合学术研究和工业之间的差距，IAD算法仍然存在机会。

【挑战】多目标神经架构搜索（NAS）是IAD寻找最佳权衡架构的一个非常有前景的方向。如果IAD模型可以应用于实践中，则需要满足许多目标，如推断速度快、存储使用低和连续学习能力。因为在生产线上使用的边缘设备的存储容量受到严格限制。

## V. 结论 

本文介绍了IM-IAD，迄今为止最完整的基于工业制造的IAD基准，包括19种算法、7个数据集和5个设置。我们深入了解了完全监督学习中部分标签的重要性，噪声比在嘈杂设置中的影响，连续学习的设计原则，以及全局特征在逻辑异常中的重要作用。除此之外，我们还提出了几条有趣的工业IAD未来发展方向。