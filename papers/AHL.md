---
Publish: CVPR2024
Url: https://arxiv.org/pdf/2310.12790.pdf
创新点: 训练集为大量正常图像和少量异常图像
---
- 必须与 DevNet 或 DRA 一起使用。

## 摘要

开放集监督异常检测（OSAD）是一个近年来新兴的异常检测领域，旨在利用**训练期间见过的少量异常类样本**来检测未见异常（即来自开放集异常类的样本），同时有效识别已见异常。受到已见异常所示先验知识的影响，当前的OSAD方法通常可以大幅减少误报错误。然而，这些方法是在封闭集设置下训练的，并将异常示例视为来自同质分布，这使它们在一般情况下泛化到可能来自任何分布的未见异常时效果较差。本文提出利用有限异常示例学习异质异常分布以解决此问题。为此，我们引入了一种新方法，即异常异质性学习（AHL），该方法模拟了多样化的异质异常分布集合，然后利用它们在替代开放集环境中学习统一的异质异常模型。此外，AHL是一个通用框架，现有的OSAD模型可以轻松接入以增强其异常建模能力。对九个真实世界的异常检测数据集进行的大量实验证明，AHL能够：1）显著增强不同最先进的OSAD模型在检测已见和未见异常方面的能力；2）在新领域有效地泛化到未见异常。代码可在https://github.com/mala-lab/AHL找到。

## 引言

异常检测（AD）旨在识别与大多数数据显著偏离的数据点。由于在工业检验、医学成像和科学发现等各个领域的广泛应用，它在学术界和工业界引起了相当大的关注。

由于收集大规模标记的异常数据往往困难或代价高昂，大多数现有的AD方法将其视为一类问题，在训练期间只有正常样本可用。

然而，在许多应用中通常存在少量可访问的异常示例，例如过去工业检查中识别出的缺陷样本和过去患者的肿瘤图像。

异常示例提供了关于异常的重要先验知识，但这些基于单类的方法无法利用它们。

开放集监督AD（OSAD）是一个近年来新兴的领域，旨在利用这些有限的训练异常数据学习用于检测未见异常的广义模型（即来自开放集异常类的样本），同时有效地识别那些已见异常（即与训练异常示例相似的异常）。

已有一些方法用于解决这个OSAD问题。受到已见异常所示先验知识的影响，当前的OSAD方法通常可以大幅减少误报错误。

当前OSAD方法的一个问题是，它们将异常示例视为来自同质分布，如图1（a）所示，这会大大限制它们在检测未见异常方面的性能。这是因为异常可能来自广泛的条件，并且本质上是不受限制的，导致异质异常分布（即异常可能来自非常不同的分布）。例如，肿瘤图像可以根据肿瘤的性质在外观、形状、大小和位置等方面展示不同的特征。当前的OSAD方法忽略了这种异常异质性，并且如果异常来自与已见异常不同的数据分布，则通常无法检测到异常。

为了解决这个问题，我们提出利用有限的训练异常示例学习异质异常分布。这些异常只是已见异常类的示例，不能说明每个可能的异常类的分布，例如那些未见的异常类，使得使用有限异常信息学习底层异质异常分布具有挑战性。

本文介绍了一种新的框架，即Anomaly Heterogeneity Learning（AHL），来解决这个挑战。如图1（b）所示，它首先通过将正常示例的细粒度分布与随机选择的异常示例关联起来，模拟了多样化的异质异常分布。然后，AHL执行协作可微学习，合成所有这些异常分布来学习异质异常模型。此外，生成的异常数据使得我们的模型能够在替代开放集环境中进行训练，其中一部分异常分布用于模型训练，而其他部分异常分布用作未见数据以验证和调整模型，从而产生比当前在封闭集设置下训练的方法更好的泛化模型。此外，模拟的异常分布通常具有不同的质量。

因此，在AHL中设计了一种自监督的泛化能力估计方法，以自适应地调整模型训练过程中每个学习的异常分布的重要性。AHL的一个直接替代方法是基于对模拟的异质数据分布进行简单整合构建集成模型。然而，这种集成方法未考虑基础模型中捕获的异常异质性的共性和差异，导致异质性的学习不够优化。

因此，本文提出了四个主要贡献：
（1）框架：我们提出了Anomaly Heterogeneity Learning（AHL），一个用于OSAD的新框架。与当前方法不同，后者将训练异常示例视为同质分布，AHL利用这些有限的示例学习异质异常分布，从而实现对未见异常的更广义检测。
（2）新颖模型：我们进一步将AHL框架实例化为一个新的OSAD模型。该模型通过协作可微学习利用模拟的多样化的异质异常分布，促进了在替代开放集环境中模型的迭代验证和调整。这使得异质性的学习比简单的集成方法更加优化。
（3）通用性：我们的模型是通用的，可以插入并使用来自不同OSAD模型的特征和损失函数，并获得明显改进的检测性能。
（4）强大的泛化能力：对九个真实世界的AD数据集进行的实验表明，在相同领域和跨领域设置下，AHL在检测未见异常方面明显优于最先进的模型。

## 3. 异常异质性学习 

问题陈述：我们假设有一组训练图像和注释 $\{(\omega_i, y_i)\}_{i=1}^N$，其中 ωi ∈ Ω ⊂ R H×W×C 表示具有RGB通道的图像，yi ∈ Y ⊂ {0, 1} 表示图像级别的类别标签，如果 ωi 是异常的则 yi = 1，否则 yi = 0。由于异常的稀缺性，标记的数据通常主要由正常数据组成。

给定一个现有的AD模型 $f(\cdot)$，可以用于提取低维图像特征以构建训练特征集 D = {xi, yi}，其中 xi = f(ωi) ∈ X 表示对应的第i个图像特征，其中 Xn = {x1, x2, ..., xN } 和 Xa = {x1, x2, ..., xM}（N ≫ M）分别表示正常图像和异常图像的特征集，那么我们提出的AHL框架的目标是学习一个异常检测函数 $g : \mathcal{X} \to \mathbb{R}$，能够将来自不同分布的异常图像分配更高的异常分数，而对于正常图像分配较低的异常分数。请注意，在OSAD中，训练异常 Xa 来自已见异常类 S，这只是 C 的一个子集，而 C 在推断期间可能包含更大的异常类集合，例如 S ⊂ C。

### 3.1. 我们方法的概述 

我们AHL框架的关键思想是通过协作可微学习来学习一个统一的异常异质性模型，该模型嵌入了多样化的模拟异常分布中的异常。如图2所示，

AHL包括两个主要组成部分：
- 异质异常分布生成（HADG）
- 异常异质性的协作可微学习（CDL）

具体来说，HADG组件从训练集中模拟并生成 T 个异质分布数据集，T = {Di}^T_i=1，其中每个 Di 包含了一个正常数据子集和随机抽样的异常示例混合。每个 Di 是以一种不同于其他的方式生成的，表示不同的异常分布。然后，CDL被设计为学习一个统一的异质异常检测模型 g(T ; θg)，该模型综合了一组 T 个基础模型，表示为 {ϕi(Di ; θi)}^T_i=1，其中 θg 和 θi 分别表示统一模型 g 和基础模型 ϕi 的可学习权重参数，每个 ϕi : Di → R 从一个异常分布中学习异常评分。基于基础模型权重 {θi}^T_i=1，协作更新权重参数 θg。此外，单个基础模型的有效性可能差异很大，因此在CDL中添加了一个模块 ψ，如果对应的基础模型 ϕi 估计具有较小的泛化误差，则增加 θi 在协作权重更新中的重要性。在推断期间，只使用统一的异质异常模型 g(T ; θg) 进行异常检测。 AHL是一个通用框架，可以轻松地插入现成的OSAD模型以实例化 ϕi，并获得显著改进的性能。

### 3.2. 异质异常分布数据的生成 

学习底层复杂异常性的一个主要挑战是缺乏说明不同可能的异常分布的训练数据。我们的HADG组件旨在解决这个挑战，其中我们将正常示例分成不同的簇，并将每个正常簇与随机抽样的异常示例关联起来，以创建多样化的异常分布。由此产生的分布在正常模式和/或异常模式方面彼此不同。具体来说，HADG生成了 T 组训练异常分布数据，T = {Di}^T_i=1，其中每个 Di = Xn,i ∪ Xa,i，其中 Xn,i ⊂ Xn 和 Xa,i ⊂ Xa。为了模拟质量良好的异常分布，Xn,i 应该代表一个主要的正常模式。为此，HADG采用聚类方法将 Xn 划分为 C 个簇，然后随机选择这些 C 个正常簇中的一个作为 Xn,i。另一方面，为了确保每个 Di 中的异常的多样性，Xa,i 是从 Xa 随机抽取的，并通过流行的异常生成方法[22, 60, 63]生成伪异常。

  
## 实验 

### 4.1. 实验设置 

【数据集】遵循先前的OSAD研究[15, 32]，我们在九个真实世界的异常检测数据集上进行了大量实验，包括五个工业缺陷检验数据集（MVTec AD [5]，AITEX [42]，SDD [44]，ELPV [13] 和Optical [50]），一个行星探测数据集（Mastcam [20]），以及三个医学数据集（HeadCT [40]，BrainMRI [40] 和Hyper-Kvasir [7]）。

根据我们如何采样已见异常示例，我们使用了两种协议来评估检测性能，即一般设置和困难设置[15]。一般设置假设异常示例是从异常类中随机采样的，而困难设置提供了一个更具挑战性的情况，其中异常示例仅从一个类中采样以评估对新颖或未见异常类的泛化能力。

我们的实验中同时使用了这两种协议。按照[15]的做法，我们还评估了将异常示例数量分别设置为 M = 10 和 M = 1 时的性能。有关这些数据集的更多详细信息，请参见附录A。 

【竞争方法和评估指标】我们将AHL与五种相关的最先进方法进行了比较，包括MLEP [24]，SAOE [22, 30, 45]，FLOS [23]，DevNet [32] 和DRA [15]。MLEP，DevNet和DRA专门设计用于OSAD。SAOE是一个利用合成异常和异常暴露增强的监督检测器，而FLOS是基于聚焦损失的不平衡分类器。对于评估指标，我们采用广泛使用的ROC曲线下面积（AUC）来衡量所有方法和设置的性能。所有报告的结果都是在三次独立运行的平均结果基础上得出的，除非另有说明。